{"version":3,"sources":["hooks/useSessionStorage.js","../../../src/index.ts","../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js","../node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","demos/Reducer-TodoApp.js"],"names":["__webpack_require__","d","__webpack_exports__","useSessionStorage","react__WEBPACK_IMPORTED_MODULE_0__","_ref","key","getter","setter","ref","useRef","useEffect","json","window","sessionStorage","getItem","current","JSON","parse","value","stringify","setItem","createBistate_1","exports","mutate","remove","isBistate","createStore_1","__importDefault","createStore","default","_objectWithoutProperties","source","excluded","i","target","sourceKeys","Object","keys","length","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","prototype","propertyIsEnumerable","call","App","_useBireducer","useBireducer","state","action","type","todo","id","Date","now","content","text","completed","todos","push","hasActiveItem","some","forEach","assign","payload","_useBireducer2","D_Users_yj_gu_Documents_code_GitHub_bistate_examples_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","dispatch","handleAddTodo","alert","react__WEBPACK_IMPORTED_MODULE_2___default","a","createElement","Fragment","TodoInput","onKeyUp","event","onClick","Todos","Footer","map","Todo","_ref2","_useBireducer3","edit","_useBireducer4","handleEdited","onBlur","_ref3","props","D_Users_yj_gu_Documents_code_GitHub_bistate_examples_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__","handleChange","useMutate","onChange","_ref4","activeItems","filter","completedItems","handleClearCompleted","item"],"mappings":"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","file":"static/js/3.5737d052.chunk.js","sourcesContent":["import { useRef, useEffect } from 'react'\r\n\r\nexport default function useSessionStorage({ key, getter, setter }) {\r\n  let ref = useRef({ key, getter, setter })\r\n\r\n  useEffect(() => {\r\n    let json = window.sessionStorage.getItem(key)\r\n\r\n    if (json) {\r\n      ref.current.setter(JSON.parse(json))\r\n    }\r\n\r\n    return () => {\r\n      let value = JSON.stringify(ref.current.getter())\r\n      window.sessionStorage.setItem(key, value)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    ref.current = { key, getter, setter }\r\n  }, [key, getter, setter])\r\n}\r\n","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar createBistate_1 = require(\"./createBistate\");\r\nexports.mutate = createBistate_1.mutate;\r\nexports.remove = createBistate_1.remove;\r\nexports.isBistate = createBistate_1.isBistate;\r\nvar createStore_1 = __importDefault(require(\"./createStore\"));\r\nexports.createStore = createStore_1.default;\r\n//# sourceMappingURL=index.js.map","import objectWithoutPropertiesLoose from \"./objectWithoutPropertiesLoose\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}","import React from 'react'\r\nimport { remove } from 'bistate'\r\nimport { useBireducer, useMutate } from 'bistate/react'\r\nimport useSessionStorage from '../hooks/useSessionStorage'\r\n\r\nexport default function App() {\r\n  let initialState = {\r\n    todos: [],\r\n    text: {\r\n      value: ''\r\n    }\r\n  }\r\n  let [state, dispatch] = useBireducer((state, action) => {\r\n    if (action.type === 'ADD_TODO') {\r\n      let todo = {\r\n        id: Date.now(),\r\n        content: state.text.value,\r\n        completed: false\r\n      }\r\n      state.todos.push(todo)\r\n      state.text.value = ''\r\n    }\r\n\r\n    if (action.type === 'TOGGLE_ALL') {\r\n      let hasActiveItem = state.todos.some(todo => !todo.completed)\r\n\r\n      state.todos.forEach(todo => {\r\n        todo.completed = hasActiveItem\r\n      })\r\n    }\r\n\r\n    if (action.type === 'SYNC_STORAGE') {\r\n      Object.assign(state, action.payload)\r\n    }\r\n  }, initialState)\r\n\r\n  useSessionStorage({\r\n    key: 'reducer-todos-json',\r\n    getter: () => state,\r\n    setter: source => dispatch({ type: 'SYNC_STORAGE', payload: source })\r\n  })\r\n\r\n  let handleAddTodo = () => {\r\n    if (!state.text.value) {\r\n      return alert('empty content')\r\n    }\r\n    dispatch({ type: 'ADD_TODO' })\r\n  }\r\n\r\n  let handleToggleAll = () => {\r\n    dispatch({ type: 'TOGGLE_ALL' })\r\n  }\r\n\r\n  let handleKeyUp = event => {\r\n    if (event.key === 'Enter') {\r\n      handleAddTodo()\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div>\r\n        <TodoInput text={state.text} onKeyUp={handleKeyUp} />\r\n        <button onClick={handleAddTodo}>add</button>\r\n        <button onClick={handleToggleAll}>toggle-all</button>\r\n      </div>\r\n      <Todos todos={state.todos} />\r\n      <Footer todos={state.todos} />\r\n    </>\r\n  )\r\n}\r\n\r\nfunction Todos({ todos }) {\r\n  return (\r\n    <ul>\r\n      {todos.map(todo => {\r\n        return <Todo key={todo.id} todo={todo} />\r\n      })}\r\n    </ul>\r\n  )\r\n}\r\n\r\nfunction Todo({ todo }) {\r\n  let [state, dispatch] = useBireducer(\r\n    (state, action) => {\r\n      if (action.type === 'EDIT') {\r\n        state.edit.value = true\r\n        state.text.value = todo.content\r\n      }\r\n\r\n      if (action.type === 'EDITED') {\r\n        if (state.text.value === '') {\r\n          remove(todo)\r\n        } else {\r\n          state.edit.value = false\r\n          todo.content = state.text.value\r\n        }\r\n      }\r\n\r\n      if (action.type === 'REMOVE') {\r\n        remove(todo)\r\n      }\r\n\r\n      if (action.type === 'TOGGLE') {\r\n        todo.completed = !todo.completed\r\n      }\r\n    },\r\n    {\r\n      edit: {\r\n        value: false\r\n      },\r\n      text: {\r\n        value: ''\r\n      }\r\n    }\r\n  )\r\n\r\n  let handleEdit = () => {\r\n    dispatch({ type: 'EDIT' })\r\n  }\r\n\r\n  let handleEdited = () => {\r\n    dispatch({ type: 'EDITED' })\r\n  }\r\n\r\n  let handleKeyUp = event => {\r\n    if (event.key === 'Enter') {\r\n      handleEdited()\r\n    }\r\n  }\r\n\r\n  let handleRemove = () => {\r\n    dispatch({ type: 'REMOVE' })\r\n  }\r\n\r\n  let handleToggle = () => {\r\n    dispatch({ type: 'TOGGLE' })\r\n  }\r\n\r\n  return (\r\n    <li>\r\n      <button onClick={handleRemove}>remove</button>\r\n      <button onClick={handleToggle}>\r\n        {todo.completed ? 'completed' : 'active'}\r\n      </button>\r\n      {state.edit.value && (\r\n        <TodoInput\r\n          text={state.text}\r\n          onBlur={handleEdited}\r\n          onKeyUp={handleKeyUp}\r\n        />\r\n      )}\r\n      {!state.edit.value && <span onClick={handleEdit}>{todo.content}</span>}\r\n    </li>\r\n  )\r\n}\r\n\r\nfunction TodoInput({ text, ...props }) {\r\n  let handleChange = useMutate(event => {\r\n    text.value = event.target.value\r\n  })\r\n  return (\r\n    <input type=\"text\" {...props} onChange={handleChange} value={text.value} />\r\n  )\r\n}\r\n\r\nfunction Footer({ todos }) {\r\n  let activeItems = todos.filter(todo => !todo.completed)\r\n  let completedItems = todos.filter(todo => todo.completed)\r\n\r\n  let handleClearCompleted = useMutate(() => {\r\n    todos.filter(todo => todo.completed).forEach(item => remove(item))\r\n  })\r\n\r\n  return (\r\n    <div>\r\n      {activeItems.length} item{activeItems.length > 1 && 's'} left |{' '}\r\n      {completedItems.length > 0 && (\r\n        <button onClick={handleClearCompleted}>Clear completed</button>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"sourceRoot":""}